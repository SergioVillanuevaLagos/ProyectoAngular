<app-admin-sidebar></app-admin-sidebar>

<div class="container">
  <h1>Publicar Propiedad</h1>

  <form [formGroup]="formularioPropiedad" (ngSubmit)="alEnviar()">
    <!-- Fotos -->
    <div class="form-group">
      <label for="fotos">Fotos</label>
      <div class="fotos-container">
        <div
          class="foto-cuadro"
          (click)="inputImagenes.click()"
          tabindex="0"
          aria-label="Agregar fotos"
        >
          <span class="plus-icon">+</span>
          <input
            #inputImagenes
            id="fotos"
            type="file"
            (change)="alCambiarArchivo($event)"
            multiple
            accept="image/*"
            hidden
          />
        </div>

        <div class="miniaturas">
          <div
            class="miniatura-wrapper"
            *ngFor="let preview of imagenesPreview; let i = index"
          >
            <img
              [src]="preview"
              class="miniatura"
              [alt]="'Imagen ' + (i + 1)"
            />
            <span
              class="eliminar-x"
              (click)="eliminarImagen(i)"
              aria-label="Eliminar imagen"
              >×</span
            >
          </div>
        </div>
      </div>
      <div class="error" *ngIf="errorImagenes">
        Debes subir al menos una foto.
      </div>
    </div>

    <!-- Campos del formulario -->
    <ng-container
      *ngFor="let campo of [
      { id: 'area', label: 'Área (m²)', type: 'number', min: 1, placeholder: 'Área de la propiedad', error: 'El área es obligatoria y debe ser un número positivo.' },
      { id: 'habitaciones', label: 'Habitaciones', type: 'number', min: 0, placeholder: 'Número de habitaciones', error: 'El número de habitaciones es obligatorio y debe ser 0 o más.' },
      { id: 'banos', label: 'Baños', type: 'number', min: 0, placeholder: 'Número de baños', error: 'El número de baños es obligatorio y debe ser 0 o más.' },
      { id: 'ubicacion', label: 'Ubicación', type: 'text', placeholder: 'Ubicación de la propiedad', max: 100, error: 'La ubicación es obligatoria y no debe superar los 100 caracteres.' },
      { id: 'descripcion', label: 'Descripción', type: 'textarea', placeholder: 'Describe la propiedad', max: 500, error: 'La descripción es obligatoria y no debe superar los 500 caracteres.' },
      { id: 'precioMensual', label: 'Precio Mensual', type: 'number', min: 0, step: 0.01, placeholder: 'Precio mensual', error: 'El precio mensual es obligatorio y debe ser mayor o igual a 0.' }
    ]"
    >
      <div class="form-group">
        <label [for]="campo.id">{{ campo.label }}</label>

        <ng-container [ngSwitch]="campo.type">
          <textarea
            *ngSwitchCase="'textarea'"
            [id]="campo.id"
            [formControlName]="campo.id"
            [placeholder]="campo.placeholder"
            [attr.maxlength]="campo.max"
          ></textarea>

          <input
            *ngSwitchDefault
            [id]="campo.id"
            [type]="campo.type"
            [formControlName]="campo.id"
            [placeholder]="campo.placeholder"
            [attr.min]="campo.min"
            [attr.step]="campo.step"
            [attr.maxlength]="campo.max"
          />
        </ng-container>

        <div
          class="error"
          *ngIf="
            formularioPropiedad.get(campo.id)?.invalid &&
            formularioPropiedad.get(campo.id)?.touched
          "
        >
          {{ campo.error }}
        </div>
      </div>
    </ng-container>

    <!-- Tipo Locación -->
    <div class="form-group">
      <label for="tipoLocacion">Tipo de Locación</label>
      <select id="tipoLocacion" formControlName="tipoLocacion">
        <option value="" disabled>Seleccione tipo</option>
        <option *ngFor="let tipo of tiposLocacion" [value]="tipo.id">
          {{ tipo.nombre }}
        </option>
      </select>
      <div
        class="error"
        *ngIf="
          formularioPropiedad.get('tipoLocacion')?.invalid &&
          formularioPropiedad.get('tipoLocacion')?.touched
        "
      >
        El tipo de locación es obligatorio.
      </div>
    </div>

    <!-- Botón -->
    <button
      class="full-width btn-blue"
      type="submit"
      [disabled]="formularioPropiedad.invalid || errorImagenes"
    >
      Publicar
    </button>
  </form>
</div>
