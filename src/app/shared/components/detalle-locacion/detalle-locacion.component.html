<div
  class="detalle-locacion-container"
  *ngIf="locacion && !isLoading; else loadingOrError"
>
  <!-- Header con t√≠tulo y breadcrumb -->
  <div class="property-header">
    <h1 class="property-title">{{ locacion.Ubicacion }}</h1>
    <div class="property-breadcrumb">
      <span>Inicio</span> &gt; <span>Locaciones</span> &gt;
      <span>{{ locacion.Ubicacion }}</span>
    </div>
  </div>

  <!-- Galer√≠a de im√°genes -->
  <div class="property-gallery">
    <img
      class="main-image"
      [src]="getImageUrl(locacion.IDLocacion)"
      alt="Imagen principal de la casa"
      (error)="onImageError($event)"
    />
    <div class="thumbnail-container">
      <div class="thumbnail" *ngFor="let _ of [1, 2, 3]">
        <img
          [src]="getImageUrl(locacion.IDLocacion)"
          alt="Miniatura de la casa"
          (error)="onImageError($event)"
        />
      </div>
    </div>
  </div>

  <!-- Descripci√≥n y caracter√≠sticas principales -->
  <div class="property-content">
    <div class="left-column">
      <h2 class="section-title">Descripci√≥n</h2>
      <p class="property-description">{{ locacion.Descripcion }}</p>

      <div class="amenities-section">
        <h2 class="section-title">Caracter√≠sticas</h2>
        <div class="amenities-grid">
          <div
            class="amenity"
            *ngFor="
              let amenity of [
                'Wifi',
                'Estacionamiento',
                'Aire acondicionado',
                'Lavadora'
              ]
            "
          >
            <span class="amenity-icon">‚úì</span>
            <span class="amenity-name">{{ amenity }}</span>
          </div>
        </div>
      </div>
    </div>

    <div class="right-column">
      <!-- Tarjeta de resumen -->
      <div class="summary-card">
        <h3 class="summary-title">Resumen</h3>
        <div class="price-section">
          <span class="price"
            >${{ locacion.PrecioMensual | number : "1.0-0" }}</span
          >
          <span class="price-period">por mes</span>
        </div>

        <div class="quick-facts">
          <div class="fact">
            <span class="fact-icon">üõèÔ∏è</span>
            <span class="fact-value"
              >{{ locacion.Habitaciones }} dormitorios</span
            >
          </div>
          <div class="fact">
            <span class="fact-icon">üõÅ</span>
            <span class="fact-value"
              >{{
                locacion.Banos !== null && locacion.Banos !== undefined
                  ? locacion.Banos
                  : "N/A"
              }}
              ba√±os</span
            >
          </div>
          <div class="fact">
            <span class="fact-icon">üìê</span>
            <span class="fact-value">{{ locacion.Area }} m¬≤</span>
          </div>
        </div>

        <button class="contact-button" (click)="irAAgendarVisita()">
          Contactar
        </button>

        <button class="favorite-button">‚ù§ Guardar</button>
      </div>
    </div>
  </div>

  <!-- Secci√≥n de calificaci√≥n -->
  <div class="rating-section">
    <h2 class="section-title">Califica esta propiedad</h2>
    <div class="stars-container">
      <ng-container *ngFor="let star of [1, 2, 3, 4, 5]">
        <span
          class="star"
          [class.filled]="star <= (hoverRating || userRating)"
          (click)="setUserRating(star)"
          (mouseenter)="setHoverRating(star)"
          (mouseleave)="clearHoverRating()"
          >‚òÖ</span
        >
      </ng-container>
    </div>
    <button
      class="submit-rating"
      (click)="submitRating()"
      [disabled]="userRating === 0"
    >
      Enviar Calificaci√≥n
    </button>
  </div>

  <!-- Bot√≥n de reporte -->
  <div class="report-section">
    <button class="report-button" (click)="openReportModal()">
      <i class="report-icon">‚ö†</i> Reportar propiedad
    </button>
  </div>

  <!-- Modal de reporte, solo si locacion existe -->
  <app-report-modal
    *ngIf="showReportModal && locacion"
    [locacion]="locacion"
    (close)="showReportModal = false"
    (generate)="sendReport($event)"
  >
  </app-report-modal>
</div>

<!-- Estado de carga o error -->
<ng-template #loadingOrError>
  <div *ngIf="isLoading" class="loading-container">
    <div class="spinner"></div>
    <p>Cargando informaci√≥n de la locaci√≥n...</p>
  </div>
  <div *ngIf="!isLoading && hasError" class="error-container">
    <p>
      Error cargando la locaci√≥n.
      <button (click)="retryLoad()">Reintentar</button>
    </p>
  </div>
</ng-template>
